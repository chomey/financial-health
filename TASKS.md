# Tasks

- [x] Task 1: [ARCH] Initialize Next.js project with Tailwind CSS and Vitest â€” Scaffold a Next.js 15 app with TypeScript (strict mode), Tailwind CSS v4, and Vitest. Run `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --no-import-alias` (use src/ directory). Add Vitest with `npm install -D vitest @vitejs/plugin-react jsdom @testing-library/react @testing-library/jest-dom`. Create `vitest.config.ts` with jsdom environment and React plugin. Configure a custom Tailwind color palette in the CSS theme: warm greens (emerald/teal for positive metrics), warm neutrals (stone/slate for backgrounds), soft blues (for info/links), and a celebratory gold/amber for achievements. Add a `"test": "vitest run"` script to package.json. Verification: `npm run dev` serves a styled page at localhost:3000, `npm test` runs with 0 tests found (no error). [@devops]

- [x] Task 2: Set up Playwright screenshot & test infrastructure â€” Install Playwright with `npm init playwright@latest` (use tests/e2e/ directory, install browsers). Configure `playwright.config.ts` with baseURL `http://localhost:3000`, webServer that runs `npm run dev`, and a screenshot helper utility at `tests/e2e/helpers.ts` that captures and saves screenshots to `screenshots/` with descriptive filenames. Create `.gitattributes` to track `*.png *.jpg *.jpeg *.gif *.webp *.svg` via Git LFS. Write one smoke test (`tests/e2e/smoke.spec.ts`) that loads `/`, verifies the page renders with the app title, and saves a screenshot. Verification: `npx playwright test` passes, screenshot appears in `screenshots/`. [@qa]

- [x] Task 3: Build app shell & responsive layout â€” Create the main page layout: a left-hand entry panel and a right-hand dashboard panel, side by side on desktop, stacked on mobile. Add an app header with the name "Financial Health Snapshot" and a warm tagline (e.g., "Your finances at a glance â€” no judgment, just clarity"). All panels should have subtle hover lift effects, smooth transitions, and a polished empty state. [@frontend]

- [x] Task 4: Build asset entry section with mock data â€” Create the Assets card in the entry panel. Pre-populate with 2-3 example assets (e.g., "Savings Account: $12,000", "TFSA: $35,000"). Each row shows a category label and dollar amount. Rows highlight on hover, show a delete button on hover. An "Add Asset" button at the bottom smoothly expands a new row with inline editing (click to type category name and amount). Support category suggestions for CA (TFSA, RRSP, RESP, FHSA, LIRA) and US (401k, IRA, Roth IRA, 529, HSA) plus universal ones (Savings, Checking, Brokerage, Home Equity, Vehicle, Other). All values click-to-edit with smooth focus transitions. [@frontend]

- [x] Task 5: Build debt entry section â€” Create the Debts card, same interaction pattern as assets. Pre-populate with 1-2 example debts (e.g., "Mortgage: $280,000", "Car Loan: $15,000"). Category suggestions: Mortgage, Car Loan, Student Loan, Credit Card, Line of Credit, Personal Loan, Other. Rows have hover highlight, hover-reveal delete, click-to-edit values, smooth add/remove animations. [@frontend]

- [x] Task 6: Build income & expense entry sections â€” Create two cards: Monthly Income and Monthly Expenses. Income has category suggestions (Salary, Freelance, Investment Income, Side Hustle, Other). Expenses has flexible categories (Rent/Mortgage Payment, Childcare, Groceries, Subscriptions, Transportation, Insurance, Utilities, "Monthly Expenses" as a catch-all, Other). Users can be as granular or broad as they want. Same interaction pattern: hover highlights, click-to-edit, smooth add/remove. Show a monthly total at the bottom of each card that animates when values change. [@frontend]

- [x] Task 7: Build financial goals section â€” Create a Goals card. Each goal has a name (e.g., "New Car", "Emergency Fund", "Vacation"), a target amount, and a current amount saved. Show an animated progress bar for each goal. Add button expands a new inline goal. Progress bars should have smooth fill animations, color transitions (warm to green as they approach 100%), and a celebratory glow effect when a goal is reached. Hover on a goal shows a tooltip with percentage and remaining amount. [@frontend]

- [x] Task 8: Build snapshot dashboard with mock calculations â€” Create the right-hand dashboard panel. Display four key metric cards: Net Worth (assets minus debts), Monthly Surplus/Deficit (income minus expenses), Financial Runway (months of expenses covered by liquid assets), and Debt-to-Asset Ratio. Use hardcoded mock values initially. Each metric card should have a large number that counts up on load, a label, a subtle icon, and a hover tooltip explaining what the metric means. Cards lift on hover. Use encouraging color coding (greens for positive metrics). [@frontend]

- [x] Task 9: Build positive insights engine â€” Below the metric cards, add an Insights section that generates 3-5 human-readable, encouraging messages based on the financial data. Use the actual values from the entry panel (wire the state). Examples: "You could comfortably cover about 18 months of expenses â€” that's a strong safety net", "Your savings are growing nicely â€” you're 60% of the way to your New Car goal", "You're spending less than you earn each month â€” that surplus is building your future". Insights should have a warm card style, subtle entrance animations, and an icon per insight type (shield for runway, trending-up for surplus, target for goals). [@fullstack]

- [x] Task 10: Wire all entry sections to shared state â€” Connect assets, debts, income, expenses, and goals to a shared React state (useReducer or useState). Dashboard metrics should recalculate live as the user edits any value. Numbers in the dashboard should animate smoothly when they change. Ensure add/edit/delete in any section immediately updates the dashboard. [@fullstack]

- [x] Task 11: Implement URL state persistence â€” Encode the full app state (all assets, debts, income, expenses, goals) as base85-encoded JSON in a `s=` query param. Update the URL on every state change (using `replaceState`, not `pushState`, to avoid polluting browser history). On page load, read the `s=` param and restore state. Add a "Copy Link" button in the header that copies the current URL to clipboard with a brief "Copied!" animation. Verify that reloading the page preserves all entered data exactly. [@fullstack]

- [x] Task 12: Add region toggle for CA/US financial vehicles â€” Add a toggle in the header or settings area that lets users choose their region (Canada, United States, or Both). The toggle should use flag icons or short labels (CA/US). When a region is selected, asset and debt category suggestions should filter to show only relevant vehicles (e.g., CA shows TFSA/RRSP but not 401k). "Both" shows all. The selection should persist in the URL state. Smooth transition when toggling. [@frontend]

- [x] Task 13: Add micro-interactions and polish â€” Audit the entire UI for interactivity polish. Ensure: all buttons have hover, focus, and active states; all cards lift on hover with shadow transitions; number inputs have smooth focus rings; add/remove items have slide-in/slide-out animations; the "runway" metric has a special celebratory glow when it exceeds 12 months; tooltips appear on hover for financial terms (e.g., "Net Worth", "Runway"); empty states have friendly illustrations or messages encouraging the user to add their first item. [@frontend]

- [x] Task 14: Mobile responsiveness pass â€” Ensure the entire app works beautifully on mobile. Entry panel stacks above dashboard. Cards are full-width. Touch targets are large enough (min 44px). Inline editing works well on mobile keyboards. The "Copy Link" button is easily accessible. Test at 375px, 768px, and 1024px widths. [@frontend]

- [x] Task 15: [MILESTONE] Full E2E test â€” Write a comprehensive end-to-end test that: loads the app, adds 3 assets, 2 debts, income and expenses, and a goal; verifies dashboard metrics update correctly; copies the URL; reloads the page; verifies all data is preserved; toggles region and verifies category suggestions change. Capture screenshots at each step. [@qa]

- [x] Task 16: Fix setState-during-render bug in all entry components â€” All 5 entry components (AssetEntry, DebtEntry, IncomeEntry, ExpenseEntry, GoalEntry) call `onChange?.(next)` inside a `setState` updater function, triggering parent state updates during rendering. Fix by moving `onChange` to a `useEffect` that fires when internal state changes. Files: `src/components/AssetEntry.tsx`, `DebtEntry.tsx`, `IncomeEntry.tsx`, `ExpenseEntry.tsx`, `GoalEntry.tsx`. Verification: `npm run dev` â€” no console warnings about setState during render. [@fullstack]

- [x] Task 17: Make region toggle visibly affect the UI â€” Toggling CA/US/Both currently has no visible effect unless you're mid-edit on an asset. Fix by: passing `region` prop to DebtEntry and adding CA/US debt categories; showing flag badges (ðŸ‡¨ðŸ‡¦/ðŸ‡ºðŸ‡¸) next to region-specific categories in dropdowns and saved items; adding a brief visual pulse on entry cards when region changes. Files: `src/app/page.tsx`, `src/components/DebtEntry.tsx`, `src/components/AssetEntry.tsx`. [@frontend]

- [x] Task 18: Replace mortgage mock data with linked Property card â€” Remove "Mortgage" from debts and "Home Equity" from assets. Add a new Property section with linked value/mortgage/equity: new `Property` interface (`{ id, name, value, mortgage }` with derived equity), new `PropertyEntry.tsx` component with same interaction patterns as other cards. Property values count toward net worth but NOT toward financial runway (illiquid). Default mock: "Home" / $450k value / $280k mortgage / $170k equity. Update URL state encoding, metrics calculations, insights. Files: `src/lib/financial-state.ts`, `src/lib/url-state.ts`, `src/app/page.tsx`, new `src/components/PropertyEntry.tsx`, `src/components/AssetEntry.tsx`, `src/components/DebtEntry.tsx`, `src/lib/insights.ts`. [@fullstack]

- [x] Task 19: Fix z-index and mouseover issues in dashboard column â€” Tooltips and hover states broken in the right column. Fix z-index stacking, ensure tooltips aren't clipped by overflow, and verify all mouseover interactions work. Files: `src/components/SnapshotDashboard.tsx`, `src/app/page.tsx`. [@frontend]

- [x] Task 20: Fix hydration mismatch in PropertyEntry â€” Server-rendered property IDs don't match client IDs (e.g., `data-testid="equity-13"` on server vs `data-testid="equity-p1"` on client), causing React hydration errors. The root cause is that mock data IDs are generated with `Date.now()` or `Math.random()` which differ between server and client. Fix by using stable, deterministic IDs for default/mock data (e.g., `"p1"`, `"p2"`). Check all other entry components (AssetEntry, DebtEntry, IncomeEntry, ExpenseEntry, GoalEntry) for the same pattern and fix them too. Verification: `npm run dev` â€” no hydration mismatch warnings in the browser console. [@fullstack]

- [x] Task 21: Make region toggle obviously useful â€” The CA/US/Both toggle currently only affects category suggestions when adding new items and shows a subtle 0.6s pulse. Users can't tell what it does. Fix by: (1) adding a visible label or tooltip explaining the toggle's purpose (e.g., "Filter account types by region"); (2) when a region is selected, visually dim or badge existing items that don't belong to that region (e.g., if US is selected, show TFSA rows with a subtle "CA" badge and slightly muted styling); (3) group or sort suggestions by region with section headers in the dropdown; (4) show a brief toast or inline message on toggle like "Showing US account types" so the user gets immediate feedback. The goal: a user toggling this should instantly understand what changed and why. [@frontend]

- [x] Task 22: Add ROI and monthly contributions to assets â€” Each asset should optionally support an expected annual ROI percentage and a monthly contribution amount. Add two new optional fields to the Asset interface: `roi` (number, annual %) and `monthlyContribution` (number, $). In the UI, show these as secondary fields below each asset row â€” greyed out placeholder text like "Annual return %" and "Monthly contribution" that become editable on click. When set, display them as subtle badges (e.g., "7% ROI", "+$500/mo") next to the asset value. Pre-populate smart defaults for known account types: 401k/IRA/Roth IRA â†’ 7% ROI, TFSA/RRSP â†’ 5% ROI, Savings â†’ 2% ROI â€” shown as greyed-out suggestions the user can accept or override. These values feed into the projection graph (Task 25). Update URL state encoding to persist ROI and contribution values. [@fullstack]

- [ ] Task 23: Add interest rate and monthly payment to properties â€” Expand the Property interface with optional fields: `interestRate` (annual %), `monthlyPayment` ($), and `amortizationYears` (number). Display these as secondary detail fields below each property row, similar to Task 22's approach â€” greyed-out placeholders that become editable on click. When set, show computed info: monthly interest cost vs principal portion, total interest over remaining term, and estimated payoff date. The interest rate should affect the property's impact on growth projections (Task 25) â€” mortgage interest is a cost that reduces net worth growth. Smart defaults: suggest 5% interest rate, calculate a reasonable monthly payment from the mortgage amount. Update URL state encoding. Files: `src/lib/financial-state.ts`, `src/components/PropertyEntry.tsx`, `src/lib/url-state.ts`. [@fullstack]

- [ ] Task 24: Add interest rate to debts â€” Each debt should optionally support an interest rate (annual %) and minimum monthly payment. Add `interestRate` and `monthlyPayment` optional fields to the debt interface. Show as greyed-out secondary fields below each debt row, editable on click. When set, display as subtle badges (e.g., "19.9% APR", "$150/mo"). Pre-populate smart defaults for known debt types: Credit Card â†’ 19.9%, Car Loan â†’ 6%, Student Loan â†’ 5%, Personal Loan â†’ 8%. These values feed into the projection graph (Task 25) and insights engine (prioritize paying off high-interest debt first). Update URL state and insights. [@fullstack]

- [ ] Task 25: Build financial projection timeline graph â€” Add a time-series projection chart below the dashboard metrics. Install a lightweight chart library (recharts or chart.js). The graph should project net worth over 1â€“30 years (user-adjustable slider) using data from assets (with ROI + contributions from Task 22), properties (with interest from Task 23), debts (with interest + payments from Task 24), and monthly surplus. Show multiple lines: (1) Total Net Worth projection, (2) one line per goal showing when the goal target is reached (with a marker at the intersection), (3) debt-free date (where all debts hit $0), (4) key milestones like "first $100k", "first $1M". The graph should be interactive â€” hover to see values at any point in time. Include a toggle for optimistic/conservative/custom scenarios. Make it responsive and visually polished with smooth animations on data changes. [@fullstack]

- [ ] Task 26: [MILESTONE] Full E2E test for new features â€” Comprehensive E2E test covering: asset ROI and contribution fields, property interest rate and payment fields, debt interest rate fields, projection graph rendering with multiple lines, goal target intersections on the graph, timeline slider interaction, region toggle visibility improvements. Capture screenshots at each step. [@qa]
